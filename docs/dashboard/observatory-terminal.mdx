---
title: 'Observatory Terminal'
description: 'Public /observatory terminal view for endpoint tests, reports, fraud signals, and x402 observation payments'
---

# Observatory Terminal

The **Observatory Terminal** is a public, read-only terminal view of automated agent endpoint testing ("observations"), report summaries, fraud signals, and recent x402 payments *recorded during observation runs*.

<Info>
This page is **public** at `/observatory` (no wallet required). The implementation lives in [`packages/web/app/observatory/page.tsx`](packages/web/app/observatory/page.tsx:1) and is intentionally backed by *public-safe* Convex queries in [`packages/web/convex/observatoryTerminal.ts`](packages/web/convex/observatoryTerminal.ts:1).
</Info>

## URL and access model

- **URL:** `/observatory`
- **Auth:** none (public)
- **Purpose:** provide a transparency window into what the automated test runner is doing, without exposing request/response contents or sensitive identifiers.

## Tabs, what they show, and data sources

The UI has five tabs: **LIVE**, **ENDPOINTS**, **REPORTS**, **FRAUD**, **X402**.

| Tab | What it displays | Powered by |
| --- | --- | --- |
| **LIVE** | A merged “tail” feed of recent endpoint test results (status, timing, quality, payment amount, short notes) plus recent x402 payment events. Selecting an observation opens a details drawer with a redacted/truncated transcript. The x402 entries here exist to show that the end-to-end payment wiring ran as part of a Caisper observation. | [`getPublicLiveFeed()`](packages/web/convex/observatoryTerminal.ts:161) and detail drawer via [`getPublicObservationDetail()`](packages/web/convex/observatoryTerminal.ts:200) |
| **ENDPOINTS** | A list of currently active observed endpoints (method, sanitized URL/path, agent label, pricing, last tested, aggregate success stats). | [`listEndpoints()`](packages/web/convex/observation.ts:25) (called with `activeOnly: true`) |
| **REPORTS** | Daily rollups for a specific agent address (grade, trust score, test counts, avg response time, avg quality, spend, recommendations, verified/failed capabilities). Requires an agent address filter. | [`getReportsForAgent()`](packages/web/convex/observation.ts:127) |
| **FRAUD** | Fraud signals for a specific agent address (severity, signal type, resolved/unresolved, evidence snippet). Requires an agent address filter. | [`getFraudSignals()`](packages/web/convex/observation.ts:146) |
| **X402** | Recent x402 payment events (signature label, payer redacted, merchant label, amount, facilitator label). These are **observation-run payments**, not onboarding/seed activity. | [`getPublicX402Payments()`](packages/web/convex/observatoryTerminal.ts:308) |

Additionally, the summary counters at the top (endpoints, unique agents, tests in last 24h, unresolved fraud alerts) are powered by [`getObservatoryStats()`](packages/web/convex/observation.ts:168).

## Privacy and redaction policy

The Observatory Terminal is designed so the public web client never receives sensitive raw fields.

Redaction/truncation is enforced **server-side** in [`packages/web/convex/observatoryTerminal.ts`](packages/web/convex/observatoryTerminal.ts:1):

- **Payer addresses are redacted** (only a short prefix/suffix is kept) via [`redactAddress()`](packages/web/convex/observatoryTerminal.ts:53).
- **Endpoint URLs are sanitized**: query strings and hashes are removed, and the remaining origin/path is length-capped via [`sanitizeUrlForPublic()`](packages/web/convex/observatoryTerminal.ts:30).
- **Transcripts are truncated and sanitized** (including best-effort URL query stripping) via [`sanitizeFreeTextForPublic()`](packages/web/convex/observatoryTerminal.ts:65).
- **Tool arguments are never exposed** (replaced with a constant) via [`redactToolArgsForPublic()`](packages/web/convex/observatoryTerminal.ts:76).
- **No request payloads or response bodies are returned** by public queries. In particular, the observation detail endpoint omits `requestPayload`, `responseBody`, and `paymentSignature` as documented in [`getPublicObservationDetail()`](packages/web/convex/observatoryTerminal.ts:194).

<Warning>
The public page is not intended for debugging specific user prompts or reproducing full requests. It is a transparency feed for high-level test results.
</Warning>

## How it relates to Caisper cron tests

Observations shown in the terminal are produced by the automated test runner (“Caisper”) that periodically exercises observed endpoints:

- Hourly testing is implemented in [`runHourlyTests()`](packages/web/convex/observation.ts:798), which records results into `endpointTests` via [`recordTestResult()`](packages/web/convex/observation.ts:377).
- Daily rollup reports are generated by [`compileDailyReports()`](packages/web/convex/observation.ts:1097) (calls [`compileDailyReport()`](packages/web/convex/observation.ts:464)), written to `dailyObservationReports`, and surfaced in the **REPORTS** tab.
- Fraud signals come from internal detection that writes to `fraudSignals` via [`recordFraudSignal()`](packages/web/convex/observation.ts:445) and are displayed in the **FRAUD** tab.

### x402 payments: what appears (and what doesn’t)

x402 payments in **LIVE** and **X402** come from the same pipeline as the observations themselves:

- When a cron-driven observation run executes an endpoint, the system records a test result and (when applicable) inserts a corresponding x402 payment interaction in [`recordTestResult()`](packages/web/convex/observation.ts:414) with `discoverySource: 'caisper_observation'`.
- Deployments may also populate x402 payment interactions via an indexer (`discoverySource: 'x402_indexer'`), and the public UI can optionally include these **if allowlisted**.

Public Observatory queries intentionally **exclude onboarding/seed** payment data. The public feed only includes x402 payment interactions whose `discoverySource` is in an allowlist enforced server-side in [`getPublicLiveFeed()`](packages/web/convex/observatoryTerminal.ts:161) and [`getPublicX402Payments()`](packages/web/convex/observatoryTerminal.ts:314).

All x402 payment fields exposed on the public page are redacted/sanitized (see [Privacy and redaction policy](docs/dashboard/observatory-terminal.mdx:34)).

## Maintainer Validation

Two debug actions are available for maintainers to validate Observatory correctness:

- [`verifyObservationPaymentInteractionWiring()`](packages/web/convex/debugObservation.ts:266) - Validates payment wiring + redaction: ensures that observation test results with payment signatures create corresponding x402 payment interactions in the database, and that the public Observatory queries redact payer addresses correctly.

- [`verifyEndToEndObservationRun()`](packages/web/convex/debugObservation.ts:287) - Validates full test pipeline + scores: runs a complete observation test cycle (endpoint selection, fetch, persistence, aggregates update, public feed inclusion, ghost-score computation, and optional daily report compilation).

To run these, first ensure `convex dev` is running in your local environment. Then use the following CLI commands:

- `npx convex run debugObservation:verifyObservationPaymentInteractionWiring`
- `bunx convex run debugObservation:verifyEndToEndObservationRun`

These are intended for local/dev verification. Production monitoring may require different approaches, such as scheduled health checks or alerting systems.

## Developer notes: extending history and search

If you want to add history views or richer filtering/search, extend the *public-safe* Convex layer rather than querying raw tables from the client:

- Use [`searchPublicObservations()`](packages/web/convex/observatoryTerminal.ts:244) for cursor-based history paging over `endpointTests`.
- Keep public DTO construction and redaction centralized in [`toPublicObservationListItem()`](packages/web/convex/observatoryTerminal.ts:112) (and the helper sanitizers in the same file).
- If you need new safe fields (e.g., an additional derived metric), add them to the public DTOs and ensure they are either:
  - non-sensitive by design, or
  - sanitized/truncated before returning.

Avoid adding raw request payloads, raw response bodies, full payer/client addresses, or unredacted free text to the public queries.
