---
title: Deployment Guide
description: Step-by-step guide to deploying GhostSpeak to production
---

# GhostSpeak Production Deployment Guide

This comprehensive guide walks you through deploying Ghost Speak to production, from smart contracts to web application.

## Prerequisites

Before starting, ensure you have:

- [ ] Solana CLI installed and configured
- [ ] Node.js 24+ or Bun 1.3+ installed
- [ ] Anchor CLI installed (for smart contracts)
- [ ] Vercel account (for web hosting)
- [ ] Convex account (for database)
- [ ] Stripe account (for payments)
- [ ] Domain name registered

---

## Phase 1: Smart Contract Deployment

### 1.1 Prepare for Mainnet

**Update Anchor.toml:**

```toml
[provider]
cluster = "mainnet"
wallet = "/path/to/mainnet/wallet.json"

[[programs.mainnet]]
address = "your_program_id_here"
path = "programs/"

[scripts]
test = "bun test"
```

**Build for Production:**

```bash
# Build with optimizations
anchor build --release

# Verify program size (should be <10MB)
ls -lh target/deploy/*.so
```

### 1.2 Security Audit

**CRITICAL: Do NOT deploy to mainnet without an audit**

1. Hire reputable auditor:
   - Neodyme
   - OtterSec
   - Kudelski Security
   - Trail of Bits

2. Address all findings
3. Implement recommended fixes
4. Get final approval

### 1.3 Deploy to Mainnet

**Configure Mainnet Wallet:**

```bash
# Set mainnet network
solana config set --url https://api.mainnet-beta.solana.com

# Create or import mainnet wallet
solana-keygen new --outfile ~/.config/solana/mainnet-wallet.json

# Fund wallet (you'll need real SOL)
# Buy SOL from exchange and transfer
```

**Deploy Program:**

```bash
# Deploy to mainnet
anchor deploy --provider.cluster mainnet

# Save program ID
export PROGRAM_ID=$(solana address -k target/deploy/ghostspeak_marketplace-keypair.json)
echo "Program ID: $PROGRAM_ID"

# Update .env with mainnet program ID
echo "GHOSTSPEAK_PROGRAM_ID_MAINNET=$PROGRAM_ID" >> .env
```

**Upload IDL:**

```bash
# Initialize IDL
anchor idl init $PROGRAM_ID \
  --filepath target/idl/ghostspeak_marketplace.json \
  --provider.cluster mainnet

# Verify IDL uploaded
anchor idl fetch $PROGRAM_ID --provider.cluster mainnet
```

### 1.4 Set Program Authority

**Configure Upgrade Authority:**

```bash
# Option A: Set to null (immutable program - RECOMMENDED after audit)
solana program set-upgrade-authority $PROGRAM_ID --final

# Option B: Set to multisig (allows upgrades with governance)
solana program set-upgrade-authority $PROGRAM_ID \
  --new-upgrade-authority <MULTISIG_ADDRESS>
```

**Set Admin Keys:**

```bash
# These should be multisig addresses, not individual wallets
export ADMIN_KEY="YourMultisigAddress111111111111111111111111"
export FEE_RECEIVER="YourFeeReceiverAddress11111111111111111111"

# Update program configuration (if your program has admin functions)
# This will vary based on your implementation
```

### 1.5 Verify Deployment

```bash
# Get program info
solana program show $PROGRAM_ID

# Verify executable
solana program dump $PROGRAM_ID /tmp/program.so
sha256sum /tmp/program.so

# Compare with local build
sha256sum target/deploy/ghostspeak_marketplace.so
```

---

## Phase 2: Database Setup (Convex)

### 2.1 Create Production Deployment

```bash
# Navigate to web package
cd packages/web

# Deploy to Convex production
npx convex deploy --prod

# Save deployment URL
export CONVEX_URL=$(npx convex env get CONVEX_URL)
echo "NEXT_PUBLIC_CONVEX_URL=$CONVEX_URL" >> .env.production
```

### 2.2 Configure Authentication

**In Convex Dashboard:**

1. Go to Settings > Authentication
2. Enable desired auth methods:
   - Wallet authentication (primary)
   - Email (optional, via Convex Auth)
3. Configure OAuth providers if using social login
4. Save API keys

**Update .env.production:**

```bash
CONVEX_DEPLOYMENT=your-deployment-name
CONVEX_DEPLOY_KEY=your_deploy_key_here
```

### 2.3 Set Up Backups

Convex automatically backs up your data, but verify:

1. Go to Settings > Backups
2. Verify backup schedule (daily recommended)
3. Test restore procedure
4. Document recovery process

---

## Phase 3: Payment Configuration

### 3.1 Stripe Setup

**Create Production Account:**

1. Go to [Stripe Dashboard](https://dashboard.stripe.com)
2. Complete account verification
3. Enable live mode
4. Go to Developers > API keys

**Configure Webhook:**

```bash
# Create webhook endpoint in Stripe Dashboard
URL: https://your-domain.com/api/stripe/webhook
Events to subscribe:
  - payment_intent.succeeded
  - payment_intent.failed
  - customer.subscription.created
  - customer.subscription.updated
  - customer.subscription.deleted

# Save webhook secret
export STRIPE_WEBHOOK_SECRET="whsec_..."
```

**Create Products:**

```bash
# Use Stripe CLI or dashboard to create subscription products
stripe products create \
  --name "GhostSpeak Starter" \
  --description "100 API requests/hour"

stripe prices create \
  --product=prod_... \
  --unit-amount=4900 \
  --currency=usd \
  --recurring[interval]=month
```

**Update Environment:**

```bash
# In .env.production
STRIPE_SECRET_KEY=sk_live_...
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...
```

### 3.2 PayAI Configuration

**Create Production Account:**

1. Sign up at PayAI
2. Complete KYB verification
3. Generate API credentials
4. Configure webhook endpoint

**Setup Webhook:**

```bash
# In PayAI dashboard
Webhook URL: https://your-domain.com/api/payai/webhook
Events: payment.succeeded, payment.failed

# Update .env.production
PAYAI_API_KEY=your_api_key
PAYAI_WEBHOOK_SECRET=your_webhook_secret
```

---

## Phase 4: Monitoring & Analytics

### 4.1 Sentry Configuration

**Create Production Project:**

1. Go to [Sentry Dashboard](https://sentry.io)
2. Create new project "ghostspeak-web"
3. Select Next.js platform
4. Copy DSN

**Configure Environment:**

```bash
# .env.production
SENTRY_DSN=https://your-dsn@sentry.io/project-id
NEXT_PUBLIC_SENTRY_DSN=https://your-dsn@sentry.io/project-id
SENTRY_ORG=your-org
SENTRY_PROJECT=ghostspeak-web
SENTRY_AUTH_TOKEN=your_auth_token
```

**Set Up Alerts:**

1. Go to Alerts > Create Alert
2. Configure critical error alerts:
   - Email: immediate
   - Slack: #incidents channel
3. Set up performance alerts:
   - P95 latency > 1s
   - Error rate > 1%

### 4.2 PostHog Setup

**Create Production Project:**

1. Go to [PostHog](https://posthog.com)
2. Create production project
3. Copy API key

**Configure:**

```bash
# .env.production
NEXT_PUBLIC_POSTHOG_KEY=phc_...
NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com
```

**Create Dashboards:**

1. User engagement
2. API usage
3. Conversion funnels
4. Feature flags

### 4.3 Uptime Monitoring

**UptimeRobot Setup:**

1. Go to [UptimeRobot](https://uptimerobot.com)
2. Create monitors:
   - Main site: https://ghostspeak.io
   - Health check: https://ghostspeak.io/api/health
   - API: https://ghostspeak.io/api/v1/health
3. Set check interval: 5 minutes
4. Configure alert contacts:
   - Email: ops@ghostspeak.io
   - Slack: #alerts

**Status Page:**

1. Create status page (status.ghostspeak.io)
2. Link monitors
3. Customize branding
4. Test incident workflow

---

## Phase 5: Web Application Deployment

### 5.1 Prepare Production Build

**Optimize Next.js Config:**

```typescript
// next.config.ts
export default {
  // ... existing config

  // Production optimizations
  reactStrictMode: true,
  swcMinify: true,
  compress: true,

  // Image optimization
  images: {
    domains: ['your-cdn.com'],
    formats: ['image/webp', 'image/avif'],
  },

  // Security headers
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          { key: 'X-Frame-Options', value: 'DENY' },
          { key: 'X-Content-Type-Options', value: 'nosniff' },
          { key: 'Referrer-Policy', value: 'strict-origin-when-cross-origin' },
          {
            key: 'Strict-Transport-Security',
            value: 'max-age=31536000; includeSubDomains',
          },
        ],
      },
    ]
  },
}
```

**Build and Test:**

```bash
# Build production bundle
bun run build

# Test locally
bun run start

# Run E2E tests against production build
NODE_ENV=production bun run test:e2e
```

### 5.2 Deploy to Vercel

**Install Vercel CLI:**

```bash
npm i -g vercel
```

**Login and Link:**

```bash
# Login to Vercel
vercel login

# Link project
cd packages/web
vercel link
```

**Configure Environment Variables:**

```bash
# Set production environment variables in Vercel dashboard
# Or use CLI:

vercel env add NEXT_PUBLIC_CONVEX_URL production
vercel env add NEXT_PUBLIC_SOLANA_RPC_URL production
vercel env add SERVER_WALLET_PRIVATE_KEY production
# ... (add all required variables)
```

**Deploy:**

```bash
# Deploy to production
vercel --prod

# Or via GitHub integration (recommended)
# Just push to main branch
```

**Verify Deployment:**

```bash
# Check deployment status
vercel inspect your-deployment-url

# Test health endpoint
curl https://your-domain.com/api/health

# Run smoke tests
bun run test:smoke:production
```

### 5.3 Configure Custom Domain

**Add Domain in Vercel:**

1. Go to Project Settings > Domains
2. Add your domain: `ghostspeak.io`
3. Add www subdomain: `www.ghostspeak.io`
4. Configure redirects: www â†’ apex

**Update DNS Records:**

```bash
# A Record (apex domain)
Type: A
Name: @
Value: 76.76.21.21  # Vercel IP

# CNAME (www subdomain)
Type: CNAME
Name: www
Value: cname.vercel-dns.com

# CNAME (API subdomain)
Type: CNAME
Name: api
Value: cname.vercel-dns.com
```

**SSL Certificate:**

Vercel automatically provisions SSL certificates. Verify:

```bash
# Check SSL
curl -I https://ghostspeak.io | grep -i "SSL"

# Verify HTTPS redirect
curl -I http://ghostspeak.io | grep -i "location"
```

---

## Phase 6: Post-Deployment Verification

### 6.1 Smoke Tests

```bash
# Health check
curl https://ghostspeak.io/api/health

# API endpoint
curl https://ghostspeak.io/api/v1/agents \
  -H "x-api-key: test_key"

# Ghost Score
curl https://ghostspeak.io/api/ghost-score/agents
```

### 6.2 Load Testing

```bash
# Run load tests against production
API_BASE_URL=https://ghostspeak.io \
  k6 run tests/load/b2b-api.js

# Monitor during load test
# - Sentry for errors
# - Vercel Analytics for performance
# - Server logs
```

### 6.3 User Acceptance Testing

**Test Critical Flows:**

- [ ] User signup/login
- [ ] Agent registration
- [ ] Credential issuance
- [ ] Ghost Score calculation
- [ ] API key generation
- [ ] Payment processing
- [ ] Webhook delivery

### 6.4 Monitoring Verification

**Check All Monitors Active:**

- [ ] Sentry receiving events
- [ ] PostHog tracking pageviews
- [ ] UptimeRobot sending heartbeats
- [ ] Health endpoint returning 200
- [ ] Logs flowing to dashboard

---

## Phase 7: Launch Preparation

### 7.1 Pre-Launch Checklist

**Technical:**
- [ ] All environment variables set
- [ ] SSL certificate active
- [ ] DNS propagated
- [ ] Monitoring active
- [ ] Backups configured
- [ ] Rate limiting tested
- [ ] Load tests passed
- [ ] Security headers verified

**Business:**
- [ ] Terms of Service published
- [ ] Privacy Policy published
- [ ] Support email configured
- [ ] Status page live
- [ ] Documentation complete
- [ ] Pricing tiers finalized

### 7.2 Launch Day Checklist

**Morning (T-6 hours):**
- [ ] Run final smoke tests
- [ ] Verify all monitoring active
- [ ] Check wallet balances
- [ ] Review alert configuration
- [ ] Brief support team

**Launch (T-0):**
- [ ] Flip traffic to production
- [ ] Post announcement
- [ ] Monitor error rates
- [ ] Watch user signups
- [ ] Respond to initial feedback

**Evening (T+6 hours):**
- [ ] Review metrics
- [ ] Check for errors
- [ ] Respond to support requests
- [ ] Plan next day improvements

---

## Phase 8: Post-Launch Operations

### 8.1 Daily Operations

**Morning Checks:**
```bash
# Health check
curl https://ghostspeak.io/api/health

# Error rate (Sentry)
open https://sentry.io/organizations/ghostspeak/issues/

# Uptime (UptimeRobot)
open https://uptimerobot.com/dashboard
```

**Review Metrics:**
- User signups
- API usage
- Error rates
- Performance
- Revenue

### 8.2 Maintenance Windows

**Schedule Regular Maintenance:**

- Weekly: Dependency updates
- Monthly: Security patches
- Quarterly: Major version updates

**Maintenance Procedure:**

1. Announce 24 hours ahead
2. Update status page
3. Deploy to staging first
4. Run full test suite
5. Deploy to production
6. Monitor for 1 hour
7. Update status page (resolved)

### 8.3 Incident Response

**If Critical Issue Occurs:**

1. **Triage** (0-5 minutes)
   - Assess severity
   - Notify team
   - Update status page

2. **Mitigate** (5-30 minutes)
   - Rollback if needed
   - Disable feature flags
   - Scale resources

3. **Fix** (30 minutes - 2 hours)
   - Identify root cause
   - Implement fix
   - Test thoroughly

4. **Resolve** (2-4 hours)
   - Deploy fix
   - Verify resolution
   - Update status page
   - Notify users

5. **Post-Mortem** (1-3 days)
   - Document incident
   - Identify improvements
   - Update runbooks

---

## Rollback Procedures

### Emergency Rollback

**Vercel:**
```bash
# List recent deployments
vercel ls

# Rollback to specific deployment
vercel rollback your-deployment-url.vercel.app
```

**Convex:**
```bash
# Convex doesn't support instant rollback
# Deploy previous version
git checkout <previous-commit>
npx convex deploy --prod
```

**Smart Contracts:**
```bash
# If upgrade authority not revoked
solana program deploy target/deploy/previous-version.so \
  --program-id $PROGRAM_ID
```

---

## Useful Commands

```bash
# Check deployment status
vercel inspect

# View logs
vercel logs https://ghostspeak.io

# Check environment variables
vercel env ls

# Run production build locally
bun run build && bun run start

# Test health endpoint
curl https://ghostspeak.io/api/health | jq

# Monitor real-time logs
tail -f /var/log/ghostspeak/production.log
```

---

## Support

**Production Issues:** emergency@ghostspeak.io

**Deployment Help:** devops@ghostspeak.io

**Documentation:** https://docs.ghostspeak.io/deployment

---

## Changelog

Track all production deployments:

```
2025-12-30 - v1.5.0 - Initial production deployment
2025-01-15 - v1.5.1 - Bug fixes and performance improvements
2025-02-01 - v1.6.0 - New features: X, Y, Z
```

---

**Remember:** Production is live. Real users. Real money. Double-check everything.
