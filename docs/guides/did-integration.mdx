---
title: 'DID Integration Guide'
description: 'Step-by-step guide to integrating Decentralized Identifiers into your AI agent'
---

# DID Integration Guide

This guide walks you through integrating W3C-compliant Decentralized Identifiers (DIDs) into your AI agent, from creation to cross-chain verification.

## What You'll Build

By the end of this guide, you'll have:
- ✅ Created a DID for your AI agent
- ✅ Added verification methods for authentication
- ✅ Configured service endpoints
- ✅ Exported your DID to W3C format
- ✅ Integrated DID with verifiable credentials

**Time to complete**: ~20 minutes

---

## Step 1: Install Dependencies

```bash
bun add @ghostspeak/sdk @solana/web3.js @solana/signers
```

## Step 2: Initialize Client

```typescript
import { GhostSpeakClient } from '@ghostspeak/sdk'
import { generateKeyPairSigner } from '@solana/signers'

// Initialize client (devnet for testing)
const client = new GhostSpeakClient({
  cluster: 'devnet'
})

// Create or load your agent's keypair
const agentSigner = await generateKeyPairSigner()
console.log('Agent address:', agentSigner.address)
```

## Step 3: Create Your First DID

```typescript
import {
  VerificationMethodType,
  VerificationRelationship,
  ServiceEndpointType
} from '@ghostspeak/sdk'

// Create DID with initial verification method
const createSignature = await client.did.create(agentSigner, {
  controller: agentSigner.address,
  network: 'devnet',

  // Add your agent's Ed25519 key for authentication
  verificationMethods: [{
    id: 'auth-key-1',
    methodType: VerificationMethodType.Ed25519VerificationKey2020,
    controller: `did:sol:devnet:${agentSigner.address}`,
    publicKeyMultibase: `z${agentSigner.address}`, // Simplified - use proper multibase encoding
    relationships: [VerificationRelationship.Authentication],
    createdAt: Math.floor(Date.now() / 1000),
    revoked: false
  }],

  // Add your agent's service endpoint
  serviceEndpoints: [{
    id: 'agent-api',
    serviceType: ServiceEndpointType.AIAgentService,
    serviceEndpoint: 'https://my-agent.example.com/api',
    description: 'AI Agent Service API'
  }]
})

console.log('DID created! Signature:', createSignature)
```

## Step 4: Resolve and Verify DID

```typescript
// Resolve your newly created DID
const didDoc = await client.did.resolve(agentSigner.address)

if (didDoc) {
  console.log('DID Document:', {
    did: didDoc.did,
    controller: didDoc.controller,
    verificationMethods: didDoc.verificationMethods.length,
    serviceEndpoints: didDoc.serviceEndpoints.length,
    active: !didDoc.deactivated
  })
}

// Check if DID is active
const isActive = await client.did.isActive(agentSigner.address)
console.log('DID Active:', isActive)
```

## Step 5: Add Encryption Key

Add a key agreement method for secure messaging:

```typescript
// Get DID document PDA
const [didPda] = await client.did.deriveDidPda(agentSigner.address)

// Add X25519 key for encryption
await client.did.update(agentSigner, {
  didDocument: didPda,
  addVerificationMethod: {
    id: 'encrypt-key-1',
    methodType: VerificationMethodType.X25519KeyAgreementKey2020,
    controller: didDoc.did,
    publicKeyMultibase: 'z6LSbysY2xFMRpGMhb7tFTLMpeuPRaqaWM1yECx2AtzE3KCc',
    relationships: [VerificationRelationship.KeyAgreement],
    createdAt: Math.floor(Date.now() / 1000),
    revoked: false
  }
})

console.log('Encryption key added')
```

## Step 6: Add Multiple Service Endpoints

```typescript
// Add credential repository endpoint
await client.did.update(agentSigner, {
  didDocument: didPda,
  addServiceEndpoint: {
    id: 'credentials',
    serviceType: ServiceEndpointType.CredentialRepository,
    serviceEndpoint: 'https://my-agent.example.com/credentials',
    description: 'Verifiable Credentials Repository'
  }
})

// Add DIDComm messaging endpoint
await client.did.update(agentSigner, {
  didDocument: didPda,
  addServiceEndpoint: {
    id: 'messaging',
    serviceType: ServiceEndpointType.DIDCommMessaging,
    serviceEndpoint: 'https://my-agent.example.com/didcomm',
    description: 'DIDComm Messaging Endpoint'
  }
})

console.log('Service endpoints added')
```

## Step 7: Export to W3C Format

```typescript
// Export as W3C-compliant JSON
const w3cJson = await client.did.exportW3C(agentSigner.address, true)
console.log('W3C DID Document:', w3cJson)

// Or get as JavaScript object
const w3cDoc = await client.did.getW3CDocument(agentSigner.address)

// W3C format can be used for:
// 1. Cross-chain verification (Crossmint, etc.)
// 2. Interoperability with other DID systems
// 3. Credential issuance
// 4. Standards-compliant verification
```

**Example W3C Output**:
```json
{
  "@context": [
    "https://www.w3.org/ns/did/v1",
    "https://w3id.org/security/suites/ed25519-2020/v1"
  ],
  "id": "did:sol:devnet:5VKz...",
  "controller": "did:sol:devnet:5VKz...",
  "verificationMethod": [
    {
      "id": "did:sol:devnet:5VKz...#auth-key-1",
      "type": "Ed25519VerificationKey2020",
      "controller": "did:sol:devnet:5VKz...",
      "publicKeyMultibase": "z6MkpTHR8..."
    }
  ],
  "authentication": ["did:sol:devnet:5VKz...#auth-key-1"],
  "keyAgreement": ["did:sol:devnet:5VKz...#encrypt-key-1"],
  "service": [
    {
      "id": "did:sol:devnet:5VKz...#agent-api",
      "type": "AIAgentService",
      "serviceEndpoint": "https://my-agent.example.com/api"
    }
  ]
}
```

## Step 8: Issue Credentials Using DID

Now that your agent has a DID, you can issue verifiable credentials:

```typescript
// Issue a credential using your DID
const credential = await client.credentials.issueAgentIdentityCredential({
  agentId: agentSigner.address,
  name: 'My AI Agent',
  capabilities: ['code-analysis', 'data-processing'],

  // Link to DID for verification
  did: didDoc.did,

  syncToCrossmint: true // Optional: sync to other chains
})

console.log('Credential issued:', credential)
```

## Step 9: Update Service Endpoints (Maintenance)

As your agent evolves, update service endpoints:

```typescript
// Remove old endpoint
await client.did.update(agentSigner, {
  didDocument: didPda,
  removeServiceEndpointId: 'old-api'
})

// Add new endpoint
await client.did.update(agentSigner, {
  didDocument: didPda,
  addServiceEndpoint: {
    id: 'api-v2',
    serviceType: ServiceEndpointType.AIAgentService,
    serviceEndpoint: 'https://my-agent.example.com/api/v2',
    description: 'AI Agent Service API v2'
  }
})
```

## Step 10: Deactivation (If Needed)

If you need to deactivate the DID (irreversible):

```typescript
// WARNING: This is permanent!
const confirmDeactivation = await askUser('Are you sure? This cannot be undone.')

if (confirmDeactivation) {
  await client.did.deactivate(agentSigner, {
    didDocument: didPda
  })
  console.log('DID deactivated permanently')
}
```

---

## Complete Example

Here's a complete example putting it all together:

```typescript
import { GhostSpeakClient } from '@ghostspeak/sdk'
import { generateKeyPairSigner } from '@solana/signers'
import {
  VerificationMethodType,
  VerificationRelationship,
  ServiceEndpointType
} from '@ghostspeak/sdk'

async function setupAgentDID() {
  // 1. Initialize
  const client = new GhostSpeakClient({ cluster: 'devnet' })
  const agentSigner = await generateKeyPairSigner()

  console.log('Setting up DID for agent:', agentSigner.address)

  // 2. Create DID
  await client.did.create(agentSigner, {
    controller: agentSigner.address,
    network: 'devnet',
    verificationMethods: [{
      id: 'auth-key',
      methodType: VerificationMethodType.Ed25519VerificationKey2020,
      controller: `did:sol:devnet:${agentSigner.address}`,
      publicKeyMultibase: `z${agentSigner.address}`,
      relationships: [VerificationRelationship.Authentication],
      createdAt: Math.floor(Date.now() / 1000),
      revoked: false
    }],
    serviceEndpoints: [{
      id: 'agent-api',
      serviceType: ServiceEndpointType.AIAgentService,
      serviceEndpoint: 'https://my-agent.example.com/api',
      description: 'AI Agent Service'
    }]
  })

  // 3. Resolve and verify
  const didDoc = await client.did.resolve(agentSigner.address)
  console.log('DID created:', didDoc?.did)

  // 4. Export W3C format
  const w3cJson = await client.did.exportW3C(agentSigner.address)
  console.log('W3C format ready for cross-chain verification')

  // 5. Issue first credential
  const credential = await client.credentials.issueAgentIdentityCredential({
    agentId: agentSigner.address,
    name: 'My AI Agent',
    capabilities: ['code-analysis'],
    did: didDoc.did
  })

  console.log('✅ DID setup complete!')
  console.log('✅ Credential issued!')

  return { didDoc, credential }
}

// Run setup
setupAgentDID().catch(console.error)
```

---

## Integration Patterns

### Pattern 1: DID-First Agent Registration

Create DID before registering agent:

```typescript
// 1. Create DID
await client.did.create(signer, params)

// 2. Register agent with DID
await client.agents.register(signer, {
  name: 'My Agent',
  capabilities: ['code-analysis'],
  did: `did:sol:devnet:${signer.address}` // Link to DID
})
```

### Pattern 2: Lazy DID Creation

Create DID only when needed for credentials:

```typescript
// Check if DID exists
const existingDid = await client.did.resolve(agentAddress)

if (!existingDid) {
  // Create on-demand
  await client.did.create(signer, {
    controller: agentAddress,
    network: 'devnet'
  })
}
```

### Pattern 3: Multi-Purpose Verification Methods

Add different keys for different purposes:

```typescript
const [didPda] = await client.did.deriveDidPda(signer.address)

// Authentication key
await client.did.update(signer, {
  didDocument: didPda,
  addVerificationMethod: {
    id: 'auth',
    methodType: VerificationMethodType.Ed25519VerificationKey2020,
    relationships: [VerificationRelationship.Authentication]
    // ...
  }
})

// Credential issuing key
await client.did.update(signer, {
  didDocument: didPda,
  addVerificationMethod: {
    id: 'issuer',
    methodType: VerificationMethodType.Ed25519VerificationKey2020,
    relationships: [VerificationRelationship.AssertionMethod]
    // ...
  }
})

// Encryption key
await client.did.update(signer, {
  didDocument: didPda,
  addVerificationMethod: {
    id: 'encrypt',
    methodType: VerificationMethodType.X25519KeyAgreementKey2020,
    relationships: [VerificationRelationship.KeyAgreement]
    // ...
  }
})
```

---

## Troubleshooting

### DID already exists error

**Problem**: Trying to create a DID for a controller that already has one.

**Solution**: Each controller can only have one DID. Resolve existing DID or use a different controller:

```typescript
const existing = await client.did.resolve(controller)
if (existing) {
  console.log('DID already exists:', existing.did)
  // Use existing DID
} else {
  // Create new DID
  await client.did.create(signer, params)
}
```

### Can't update DID

**Problem**: Unauthorized operation error.

**Solution**: Ensure signer is the DID controller:

```typescript
const didDoc = await client.did.resolve(address)
console.log('Controller:', didDoc.controller)
console.log('Signer:', signer.address)
// These must match!
```

### Service endpoint not appearing

**Problem**: Endpoint added but not showing in resolution.

**Solution**: Fetch latest DID document:

```typescript
// Force fresh fetch
const didDoc = await client.did.resolve(address)
console.log('Endpoints:', didDoc.serviceEndpoints)
```

---

## Best Practices

1. **Create DID early** - Create during agent registration
2. **Use descriptive IDs** - Name verification methods and services clearly
3. **Keep endpoints updated** - Remove old endpoints, add new ones
4. **Export for interop** - Regularly export W3C format for cross-chain use
5. **Don't deactivate lightly** - Deactivation is permanent
6. **Back up keys** - Losing controller key means losing DID control

---

## Next Steps

<CardGroup cols={2}>
  <Card title="DID API Reference" icon="book" href="/api/did-module">
    Complete API documentation
  </Card>
  <Card title="Verifiable Credentials" icon="certificate" href="/guides/verifiable-credentials">
    Issue credentials using DIDs
  </Card>
  <Card title="Cross-Chain Verification" icon="bridge" href="/guides/crossmint-bridge">
    Export DIDs to other chains
  </Card>
  <Card title="Examples" icon="code" href="/examples/did-operations">
    More code examples
  </Card>
</CardGroup>
