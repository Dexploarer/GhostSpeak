---
title: 'Migration Guide'
description: 'Migrate to x402 payments from traditional billing'
---

## Overview

This guide helps you migrate from traditional subscription or invoice-based billing to x402 micropayments.

## Step 1: Add SDK

```bash
npm install @ghostspeak/sdk
```

## Step 2: Configure Server

### Before (Subscriptions)

```typescript
app.post('/api/service', authMiddleware, async (req, res) => {
  if (!req.user.hasSubscription) {
    return res.status(403).json({ error: 'Subscription required' });
  }
  // ...
});
```

### After (X402 Micropayments)

```typescript
import { createX402Middleware, X402Client } from '@ghostspeak/sdk';

const x402Client = new X402Client(rpc, wallet);
const x402 = createX402Middleware({
  x402Client,
  requiredPayment: 100_000n, // Price per call
  token: USDC_MINT,
  description: 'Pay-per-use service',
});

app.post('/api/service', x402, async (req, res) => {
  // Configured - no subscription check needed!
  // ...
});
```

## Step 3: Update Clients

Clients must now handle `402 Payment Required` responses.

```typescript
import { wrapFetchWithPayment } from '@ghostspeak/sdk';

// Replace standard fetch with x402-aware fetch
const apiFetch = wrapFetchWithPayment(wallet, createPaymentHeader);

// Code remains mostly the same!
const response = await apiFetch('/api/service', {
  method: 'POST',
  body: JSON.stringify(data),
});
```

## Pricing Strategies

<AccordionGroup>
  <Accordion title="Flat Rate">
    ```typescript
    requiredPayment: 100_000n // Fixed price per call
    ```
  </Accordion>

  <Accordion title="Dynamic Pricing">
    For variable pricing, you can calculate requirements per request:

    ```typescript
    app.post('/api/compute', (req, res, next) => {
      // Calculate based on complexity
      const cost = calculateCost(req.body);

      const middleware = createX402Middleware({
        x402Client,
        requiredPayment: cost,
        token: USDC_MINT
      });

      middleware(req, res, next);
    });
    ```

  </Accordion>
</AccordionGroup>
