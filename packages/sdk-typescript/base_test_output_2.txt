
> @ghostspeak/sdk@2.0.1 test
> vitest run --reporter=verbose tests/unit/client/base-instructions.test.ts

 DEPRECATED  "cache.dir" is deprecated, use Vite's "cacheDir" instead if you want to change the cache director. Note caches will be written to "cacheDir/vitest"

 RUN  v3.2.4 /Users/home/projects/GhostSpeak/packages/sdk-typescript

 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should send a basic transaction successfully 6ms
   ‚Üí expected "spy" to be called at least once
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should send transaction with detailed results 1ms
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should handle multiple instructions in a single transaction 0ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should validate instructions before sending 2ms
   ‚Üí promise resolved "'mock-signature'" instead of rejecting
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should warn about large transaction sizes 1ms
   ‚Üí expected "warn" to be called with arguments: [ StringContaining "Transaction size" ][90m

Number of calls: [1m0[22m
[39m
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should handle transaction errors gracefully 0ms
   ‚Üí promise resolved "'mock-signature'" instead of rejecting
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should retry with exponential backoff in RPC-only mode 0ms
   ‚Üí expected "spy" to be called 3 times, but got 0 times
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should handle subscription-based confirmation when available 0ms
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should handle confirmation timeout 0ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should log instruction details during debug 5ms
   ‚Üí expected "log" to be called with arguments: [ StringContaining{‚Ä¶} ][90m

Received: 

[1m  1st log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Transaction sent, signature:",[90m
[31m+   "mock-signature",[90m
[2m  ][22m

[1m  2nd log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Signature length:",[90m
[31m+   14,[90m
[2m  ][22m

[1m  3rd log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Signature type:",[90m
[31m+   "string",[90m
[2m  ][22m

[1m  4th log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Confirmation attempt 1/30",[90m
[2m  ][22m

[1m  5th log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Status found:",[90m
[31m+   {[90m
[31m+     "confirmationStatus": "confirmed",[90m
[31m+     "confirmations": undefined,[90m
[31m+     "err": undefined,[90m
[31m+     "slot": undefined,[90m
[31m+   },[90m
[2m  ][22m

[1m  6th log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "‚úÖ Transaction confirmed via status check",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m6[22m
[39m
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should estimate transaction cost accurately 1ms
   ‚Üí expected "log" to be called with arguments: [ StringContaining{‚Ä¶} ][90m

Number of calls: [1m0[22m
[39m
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should fall back to default cost estimation on RPC failure 1ms
   ‚Üí expected 5000n to be 6000n // Object.is equality
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should simulate transactions before sending 2ms
   ‚Üí expected { Object (err, logs, ...) } to deeply equal { value: { err: null, ‚Ä¶(2) } }
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should handle simulation errors 1ms
   ‚Üí promise resolved "{ err: null, logs: [ 'Success' ], ‚Ä¶(2) }" instead of rejecting
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should calculate transaction size correctly 0ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should calculate size for multiple instructions 0ms
   ‚Üí expected 133 to be 355 // Object.is equality
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should log instruction details 3ms
   ‚Üí expected "log" to be called with arguments: [ 'üìã Instruction Details:' ][90m

Number of calls: [1m0[22m
[39m
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should get and decode a single account 1ms
   ‚Üí expected null to deeply equal { agentId: 'test-agent', ‚Ä¶(2) }
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should return null for non-existent accounts 0ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should handle decoder not found 0ms
   ‚Üí expected "warn" to be called at least once
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should get and decode multiple accounts 1ms
   ‚Üí expected [] to have a length of 3 but got +0
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should handle various data formats in account decoding 1ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should get program accounts with filters 7004ms
   ‚Üí expected [] to have a length of 1 but got +0
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should handle decoding errors gracefully in program accounts 7004ms
   ‚Üí expected "warn" to be called with arguments: [ ‚Ä¶(2) ][90m

Number of calls: [1m0[22m
[39m
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should get raw account data 1ms
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should get all program accounts for recovery 0ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should handle discriminator validation errors 0ms
   ‚Üí promise resolved "null" instead of rejecting
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Execution Helpers > should execute single instruction 1ms
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Execution Helpers > should execute instruction with context 0ms
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Execution Helpers > should execute instruction with detailed results 0ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Execution Helpers > should propagate execution errors with context 1ms
   ‚Üí expected "error" to be called with arguments: [ ‚Ä¶(2) ][90m

Received: 

[1m  1st error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "üö® GhostSpeak SDK Error:",[90m
[31m+   "Invalid instruction",[90m
[2m  ][22m

[1m  2nd error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "üîß Operation:",[90m
[31m+   "execute",[90m
[2m  ][22m

[1m  3rd error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "üìã Instruction:",[90m
[31m+   "test operation",[90m
[2m  ][22m

[1m  4th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "üè¶ Accounts provided:",[90m
[31m+   1,[90m
[2m  ][22m

[1m  5th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  1. TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA (signer)",[90m
[2m  ][22m

[1m  6th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "‚öôÔ∏è Parameters:",[90m
[31m+   {[90m
[31m+     "programId": "11111111111111111111111111111111",[90m
[31m+   },[90m
[2m  ][22m

[1m  7th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "[90m
[31m+ üí° Troubleshooting tips:",[90m
[2m  ][22m

[1m  8th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  1. Check that all required accounts are provided",[90m
[2m  ][22m

[1m  9th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  2. Verify account addresses are correct",[90m
[2m  ][22m

[1m  10th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  3. Ensure signers have sufficient SOL for transaction fees",[90m
[2m  ][22m

[1m  11th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  4. Confirm the program is deployed on the target network",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m11[22m
[39m
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Execution Helpers > should handle missing context in error messages 1ms
   ‚Üí expected "error" to be called with arguments: [ ‚Ä¶(2) ][90m

Received: 

[1m  1st error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "üö® GhostSpeak SDK Error:",[90m
[31m+   "Generic error",[90m
[2m  ][22m

[1m  2nd error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "üîß Operation:",[90m
[31m+   "execute",[90m
[2m  ][22m

[1m  3rd error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "üìã Instruction:",[90m
[31m+   "test",[90m
[2m  ][22m

[1m  4th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "üè¶ Accounts provided:",[90m
[31m+   1,[90m
[2m  ][22m

[1m  5th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  1. TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA (signer)",[90m
[2m  ][22m

[1m  6th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "‚öôÔ∏è Parameters:",[90m
[31m+   {[90m
[31m+     "programId": "11111111111111111111111111111111",[90m
[31m+   },[90m
[2m  ][22m

[1m  7th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "[90m
[31m+ üí° Troubleshooting tips:",[90m
[2m  ][22m

[1m  8th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  1. Check that all required accounts are provided",[90m
[2m  ][22m

[1m  9th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  2. Verify account addresses are correct",[90m
[2m  ][22m

[1m  10th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  3. Ensure signers have sufficient SOL for transaction fees",[90m
[2m  ][22m

[1m  11th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  4. Confirm the program is deployed on the target network",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m11[22m
[39m
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Batching > should send multiple transactions in sequence 0ms
   ‚Üí expected "log" to be called with arguments: [ StringContaining{‚Ä¶} ][90m

Number of calls: [1m0[22m
[39m
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Batching > should stop batch on first failure 0ms
   ‚Üí promise resolved "[ 'mock-signature', ‚Ä¶(2) ]" instead of rejecting
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle empty instruction arrays 2ms
   ‚Üí Cannot read properties of undefined (reading 'programAddress')
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle missing signers 0ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle very large instruction data 0ms
   ‚Üí expected "warn" to be called with arguments: [ StringContaining "Transaction size" ][90m

Number of calls: [1m0[22m
[39m
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle RPC endpoint detection fallback 0ms
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle transaction confirmation with various statuses 0ms
   ‚Üí expected "spy" to be called at least once
 √ó tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle transaction errors in confirmation status 0ms
   ‚Üí promise resolved "'mock-signature'" instead of rejecting
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Performance Tests > should handle rapid sequential transactions 1ms
 ‚úì tests/unit/client/base-instructions.test.ts > BaseInstructions > Performance Tests > should efficiently estimate costs for multiple instructions 0ms

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 26 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should send a basic transaction successfully
AssertionError: expected "spy" to be called at least once
 ‚ùØ tests/unit/client/base-instructions.test.ts:267:31
    265|       
    266|       expect(signature).toBe('mock-signature')
    267|       expect(SimpleRpcClient).toHaveBeenCalled()
       |                               ^
    268|       expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaini‚Ä¶
    269|     })

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should validate instructions before sending
AssertionError: promise resolved "'mock-signature'" instead of rejecting

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
"mock-signature"

 ‚ùØ tests/unit/client/base-instructions.test.ts:303:9
    301|         await expect(
    302|           baseInstructions.testSendTransaction([instruction] as any, [‚Ä¶
    303|         ).rejects.toThrow()
       |         ^
    304|       }
    305|     })

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should warn about large transaction sizes
AssertionError: expected "warn" to be called with arguments: [ StringContaining "Transaction size" ][90m

Number of calls: [1m0[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:313:30
    311|       await baseInstructions.testSendTransaction([largeInstruction], [‚Ä¶
    312|       
    313|       expect(consoleWarnSpy).toHaveBeenCalledWith(expect.stringContain‚Ä¶
       |                              ^
    314|       expect(consoleWarnSpy).toHaveBeenCalledWith(expect.stringContain‚Ä¶
    315|     })

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should handle transaction errors gracefully
AssertionError: promise resolved "'mock-signature'" instead of rejecting

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
"mock-signature"

 ‚ùØ tests/unit/client/base-instructions.test.ts:322:7
    320|       await expect(
    321|         baseInstructions.testSendTransaction([mockInstruction], [mockS‚Ä¶
    322|       ).rejects.toThrow('Transaction failed: RPC error')
       |       ^
    323|     })
    324| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should retry with exponential backoff in RPC-only mode
AssertionError: expected "spy" to be called 3 times, but got 0 times
 ‚ùØ tests/unit/client/base-instructions.test.ts:336:58
    334|       const duration = Date.now() - startTime
    335| 
    336|       expect(mockRpcClientInstance.getSignatureStatuses).toHaveBeenCal‚Ä¶
       |                                                          ^
    337|       expect(duration).toBeGreaterThan(1000) // Should have delays
    338|     })

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Building & Sending > should log instruction details during debug
AssertionError: expected "log" to be called with arguments: [ StringContaining{‚Ä¶} ][90m

Received: 

[1m  1st log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Transaction sent, signature:",[90m
[31m+   "mock-signature",[90m
[2m  ][22m

[1m  2nd log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Signature length:",[90m
[31m+   14,[90m
[2m  ][22m

[1m  3rd log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Signature type:",[90m
[31m+   "string",[90m
[2m  ][22m

[1m  4th log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Confirmation attempt 1/30",[90m
[2m  ][22m

[1m  5th log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "üîç Status found:",[90m
[31m+   {[90m
[31m+     "confirmationStatus": "confirmed",[90m
[31m+     "confirmations": undefined,[90m
[31m+     "err": undefined,[90m
[31m+     "slot": undefined,[90m
[31m+   },[90m
[2m  ][22m

[1m  6th log call:

[22m[2m  [[22m
[32m-   StringContaining "Debug - Instruction data",[90m
[31m+   "‚úÖ Transaction confirmed via status check",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m6[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:361:29
    359|       await baseInstructions.testSendTransaction([mockInstruction], [m‚Ä¶
    360|       
    361|       expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaini‚Ä¶
       |                             ^
    362|       expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaini‚Ä¶
    363|     })

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should estimate transaction cost accurately
AssertionError: expected "log" to be called with arguments: [ StringContaining{‚Ä¶} ][90m

Number of calls: [1m0[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:371:29
    369|       
    370|       expect(cost).toBe(BigInt(5000))
    371|       expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaini‚Ä¶
       |                             ^
    372|     })
    373| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should fall back to default cost estimation on RPC failure
AssertionError: expected 5000n to be 6000n // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 6000n[39m
[31m+ 5000n[39m

 ‚ùØ tests/unit/client/base-instructions.test.ts:380:20
    378|       const cost = await baseInstructions.testEstimateTransactionCost(‚Ä¶
    379|       
    380|       expect(cost).toBe(BigInt(6000)) // 5000 base + 1000 per instruct‚Ä¶
       |                    ^
    381|       expect(consoleWarnSpy).toHaveBeenCalledWith(
    382|         '‚ö†Ô∏è Real fee estimation failed, using fallback:',

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should simulate transactions before sending
AssertionError: expected { Object (err, logs, ...) } to deeply equal { value: { err: null, ‚Ä¶(2) } }

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "value": {[39m
[2m    "err": null,[22m
[2m    "logs": [[22m
[32m-       "Program log: Success",[39m
[31m+     "Success",[39m
[2m    ],[22m
[32m-     "unitsConsumed": 100000n,[39m
[32m-   },[39m
[31m+   "returnData": undefined,[39m
[31m+   "unitsConsumed": 100n,[39m
[2m  }[22m

 ‚ùØ tests/unit/client/base-instructions.test.ts:390:26
    388|       const simulation = await baseInstructions.testSimulateTransactio‚Ä¶
    389|       
    390|       expect(simulation).toEqual({
       |                          ^
    391|         value: {
    392|           err: null,

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should handle simulation errors
AssertionError: promise resolved "{ err: null, logs: [ 'Success' ], ‚Ä¶(2) }" instead of rejecting

[32m- Expected[39m
[31m+ Received[39m

[32m- Error {[39m
[32m-   "message": "rejected promise",[39m
[31m+ {[39m
[31m+   "err": null,[39m
[31m+   "logs": [[39m
[31m+     "Success",[39m
[31m+   ],[39m
[31m+   "returnData": undefined,[39m
[31m+   "unitsConsumed": 100n,[39m
[2m  }[22m

 ‚ùØ tests/unit/client/base-instructions.test.ts:406:7
    404|       await expect(
    405|         baseInstructions.testSimulateTransaction([mockInstruction], [m‚Ä¶
    406|       ).rejects.toThrow('Simulation failed')
       |       ^
    407|     })
    408| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should calculate size for multiple instructions
AssertionError: expected 133 to be 355 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 355[39m
[31m+ 133[39m

 ‚ùØ tests/unit/client/base-instructions.test.ts:428:20
    426|       
    427|       // 64 + (32*3) + (1+1+3)*32 + (5+10+20)
    428|       expect(size).toBe(355)
       |                    ^
    429|     })
    430| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Utilities > should log instruction details
AssertionError: expected "log" to be called with arguments: [ 'üìã Instruction Details:' ][90m

Number of calls: [1m0[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:434:29
    432|       baseInstructions.testLogInstructionDetails(mockInstruction)
    433|       
    434|       expect(consoleLogSpy).toHaveBeenCalledWith('üìã Instruction Detai‚Ä¶
       |                             ^
    435|       expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaini‚Ä¶
    436|       expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaini‚Ä¶

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should get and decode a single account
AssertionError: expected null to deeply equal { agentId: 'test-agent', ‚Ä¶(2) }

[32m- Expected:[39m 
{
  "agentId": "test-agent",
  "isActive": true,
  "owner": "owner-address",
}

[31m+ Received:[39m 
null

 ‚ùØ tests/unit/client/base-instructions.test.ts:475:23
    473|       )
    474| 
    475|       expect(account).toEqual({
       |                       ^
    476|         agentId: 'test-agent',
    477|         owner: 'owner-address',

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should handle decoder not found
AssertionError: expected "warn" to be called at least once
 ‚ùØ tests/unit/client/base-instructions.test.ts:516:30
    514| 
    515|       expect(account).toBeNull()
    516|       expect(consoleWarnSpy).toHaveBeenCalled()
       |                              ^
    517|     })
    518| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should get and decode multiple accounts
AssertionError: expected [] to have a length of 3 but got +0

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 0[39m

 ‚ùØ tests/unit/client/base-instructions.test.ts:545:24
    543|       const accounts = await baseInstructions.testGetDecodedAccounts(a‚Ä¶
    544| 
    545|       expect(accounts).toHaveLength(3)
       |                        ^
    546|       expect(accounts[0]).toBeDefined()
    547|       expect(accounts[1]).toBeNull()

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should get program accounts with filters
AssertionError: expected [] to have a length of 1 but got +0

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

 ‚ùØ tests/unit/client/base-instructions.test.ts:598:24
    596|       const accounts = await baseInstructions.testGetDecodedProgramAcc‚Ä¶
    597| 
    598|       expect(accounts).toHaveLength(1)
       |                        ^
    599|       expect(accounts[0].address).toBe('EPjFWdd5AufqSSqeM2qN1xzybapC8G‚Ä¶
    600|       expect(accounts[0].data).toEqual({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[16/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should handle decoding errors gracefully in program accounts
AssertionError: expected "warn" to be called with arguments: [ ‚Ä¶(2) ][90m

Number of calls: [1m0[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:629:30
    627| 
    628|       expect(accounts).toHaveLength(0)
    629|       expect(consoleWarnSpy).toHaveBeenCalledWith(
       |                              ^
    630|         'Failed to decode account EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGk‚Ä¶
    631|         expect.any(Error)

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[17/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Account Operations > should handle discriminator validation errors
AssertionError: promise resolved "null" instead of rejecting

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
null

 ‚ùØ tests/unit/client/base-instructions.test.ts:704:7
    702|           'getAgentAccountDecoder'
    703|         )
    704|       ).rejects.toThrow('expected 8 bytes, got 3')
       |       ^
    705|     })
    706|   })

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[18/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Execution Helpers > should propagate execution errors with context
AssertionError: expected "error" to be called with arguments: [ ‚Ä¶(2) ][90m

Received: 

[1m  1st error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "üö® GhostSpeak SDK Error:",[90m
[31m+   "Invalid instruction",[90m
[2m  ][22m

[1m  2nd error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "üîß Operation:",[90m
[31m+   "execute",[90m
[2m  ][22m

[1m  3rd error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "üìã Instruction:",[90m
[31m+   "test operation",[90m
[2m  ][22m

[1m  4th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "üè¶ Accounts provided:",[90m
[31m+   1,[90m
[2m  ][22m

[1m  5th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  1. TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA (signer)",[90m
[2m  ][22m

[1m  6th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "‚öôÔ∏è Parameters:",[90m
[31m+   {[90m
[31m+     "programId": "11111111111111111111111111111111",[90m
[31m+   },[90m
[2m  ][22m

[1m  7th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "[90m
[31m+ üí° Troubleshooting tips:",[90m
[2m  ][22m

[1m  8th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  1. Check that all required accounts are provided",[90m
[2m  ][22m

[1m  9th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  2. Verify account addresses are correct",[90m
[2m  ][22m

[1m  10th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  3. Ensure signers have sufficient SOL for transaction fees",[90m
[2m  ][22m

[1m  11th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute test operation:",[90m
[32m-   Any<Error>,[90m
[31m+   "  4. Confirm the program is deployed on the target network",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m11[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:742:31
    740|       ).rejects.toThrow('Invalid instruction')
    741| 
    742|       expect(consoleErrorSpy).toHaveBeenCalledWith(
       |                               ^
    743|         '‚ùå Failed to execute test operation:',
    744|         expect.any(Error)

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[19/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Execution Helpers > should handle missing context in error messages
AssertionError: expected "error" to be called with arguments: [ ‚Ä¶(2) ][90m

Received: 

[1m  1st error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "üö® GhostSpeak SDK Error:",[90m
[31m+   "Generic error",[90m
[2m  ][22m

[1m  2nd error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "üîß Operation:",[90m
[31m+   "execute",[90m
[2m  ][22m

[1m  3rd error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "üìã Instruction:",[90m
[31m+   "test",[90m
[2m  ][22m

[1m  4th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "üè¶ Accounts provided:",[90m
[31m+   1,[90m
[2m  ][22m

[1m  5th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  1. TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA (signer)",[90m
[2m  ][22m

[1m  6th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "‚öôÔ∏è Parameters:",[90m
[31m+   {[90m
[31m+     "programId": "11111111111111111111111111111111",[90m
[31m+   },[90m
[2m  ][22m

[1m  7th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "[90m
[31m+ üí° Troubleshooting tips:",[90m
[2m  ][22m

[1m  8th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  1. Check that all required accounts are provided",[90m
[2m  ][22m

[1m  9th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  2. Verify account addresses are correct",[90m
[2m  ][22m

[1m  10th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  3. Ensure signers have sufficient SOL for transaction fees",[90m
[2m  ][22m

[1m  11th error call:

[22m[2m  [[22m
[32m-   "‚ùå Failed to execute instruction execution:",[90m
[32m-   Any<Error>,[90m
[31m+   "  4. Confirm the program is deployed on the target network",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m11[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:755:31
    753|       ).rejects.toThrow('Generic error')
    754| 
    755|       expect(consoleErrorSpy).toHaveBeenCalledWith(
       |                               ^
    756|         '‚ùå Failed to execute instruction execution:',
    757|         expect.any(Error)

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[20/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Batching > should send multiple transactions in sequence
AssertionError: expected "log" to be called with arguments: [ StringContaining{‚Ä¶} ][90m

Number of calls: [1m0[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:774:29
    772|       expect(signatures).toHaveLength(3)
    773|       expect(signatures.every(sig => sig === 'mock-signature')).toBe(t‚Ä¶
    774|       expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaini‚Ä¶
       |                             ^
    775|       expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaini‚Ä¶
    776|     })

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[21/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Transaction Batching > should stop batch on first failure
AssertionError: promise resolved "[ 'mock-signature', ‚Ä¶(2) ]" instead of rejecting

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
[
  "mock-signature",
  "mock-signature",
  "mock-signature",
]

 ‚ùØ tests/unit/client/base-instructions.test.ts:804:7
    802|       await expect(
    803|         baseInstructions.testSendTransactionBatch(batches, [mockSigner‚Ä¶
    804|       ).rejects.toThrow('Batch transaction 2 failed')
       |       ^
    805| 
    806|       expect(consoleErrorSpy).toHaveBeenCalledWith(

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle empty instruction arrays
TypeError: Cannot read properties of undefined (reading 'programAddress')
 ‚ùØ validateInstruction src/core/InstructionBuilder.ts:36:13
     34| function validateInstruction(instruction: unknown): asserts instructio‚Ä¶
     35|   const inst = instruction as Record<string, unknown>
     36|   if (!inst.programAddress) {
       |             ^
     37|     throw new Error('Invalid instruction format')
     38|   }
 ‚ùØ InstructionBuilder.execute src/core/InstructionBuilder.ts:90:7

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[23/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle very large instruction data
AssertionError: expected "warn" to be called with arguments: [ StringContaining "Transaction size" ][90m

Number of calls: [1m0[22m
[39m
 ‚ùØ tests/unit/client/base-instructions.test.ts:860:30
    858|       await baseInstructions.testSendTransaction([largeInstruction], [‚Ä¶
    859|       
    860|       expect(consoleWarnSpy).toHaveBeenCalledWith(expect.stringContain‚Ä¶
       |                              ^
    861|     })
    862| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[24/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle transaction confirmation with various statuses
AssertionError: expected "spy" to be called at least once
 ‚ùØ tests/unit/client/base-instructions.test.ts:881:58
    879|       
    880|       // The mock should have been called, but reset the count after e‚Ä¶
    881|       expect(mockRpcClientInstance.getSignatureStatuses).toHaveBeenCal‚Ä¶
       |                                                          ^
    882|     })
    883| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[25/26]‚éØ

 FAIL  tests/unit/client/base-instructions.test.ts > BaseInstructions > Edge Cases and Error Handling > should handle transaction errors in confirmation status
AssertionError: promise resolved "'mock-signature'" instead of rejecting

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
"mock-signature"

 ‚ùØ tests/unit/client/base-instructions.test.ts:894:7
    892|       await expect(
    893|         baseInstructions.testSendTransaction([mockInstruction], [mockS‚Ä¶
    894|       ).rejects.toThrow('Transaction failed')
       |       ^
    895|     })
    896|   })

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[26/26]‚éØ


 Test Files  1 failed (1)
      Tests  26 failed | 16 passed (42)
   Start at  16:45:35
   Duration  14.36s (transform 168ms, setup 22ms, collect 175ms, tests 14.05s, environment 0ms, prepare 40ms)

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/home/projects/GhostSpeak/packages/sdk-typescript
npm error workspace @ghostspeak/sdk@2.0.1
npm error location /Users/home/projects/GhostSpeak/packages/sdk-typescript
npm error command failed
npm error command sh -c vitest run --reporter=verbose tests/unit/client/base-instructions.test.ts
