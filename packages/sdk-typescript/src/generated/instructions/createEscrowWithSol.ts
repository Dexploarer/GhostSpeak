/**
 * This code was AUTOGENERATED using the Codama library.
 * Please DO NOT EDIT THIS FILE, instead use visitors
 * to add features, then rerun Codama to update it.
 *
 * @see https://github.com/codama-idl/codama
 */

import {
  addDecoderSizePrefix,
  addEncoderSizePrefix,
  combineCodec,
  fixDecoderSize,
  fixEncoderSize,
  getAddressDecoder,
  getAddressEncoder,
  getBooleanDecoder,
  getBooleanEncoder,
  getBytesDecoder,
  getBytesEncoder,
  getI64Decoder,
  getI64Encoder,
  getOptionDecoder,
  getOptionEncoder,
  getProgramDerivedAddress,
  getStructDecoder,
  getStructEncoder,
  getU32Decoder,
  getU32Encoder,
  getU64Decoder,
  getU64Encoder,
  getUtf8Decoder,
  getUtf8Encoder,
  transformEncoder,
  type AccountMeta,
  type AccountSignerMeta,
  type Address,
  type Codec,
  type Decoder,
  type Encoder,
  type Instruction,
  type InstructionWithAccounts,
  type InstructionWithData,
  type Option,
  type OptionOrNullable,
  type ReadonlyAccount,
  type ReadonlyUint8Array,
  type TransactionSigner,
  type WritableAccount,
  type WritableSignerAccount,
} from "@solana/kit";
import { GHOSTSPEAK_MARKETPLACE_PROGRAM_ADDRESS } from "../programs";
import {
  expectAddress,
  expectSome,
  getAccountMetaFactory,
  type ResolvedAccount,
} from "../shared";

export const CREATE_ESCROW_WITH_SOL_DISCRIMINATOR = new Uint8Array([
  135, 194, 171, 90, 18, 253, 103, 115,
]);

export function getCreateEscrowWithSolDiscriminatorBytes() {
  return fixEncoderSize(getBytesEncoder(), 8).encode(
    CREATE_ESCROW_WITH_SOL_DISCRIMINATOR,
  );
}

export type CreateEscrowWithSolInstruction<
  TProgram extends string = typeof GHOSTSPEAK_MARKETPLACE_PROGRAM_ADDRESS,
  TAccountEscrow extends string | AccountMeta<string> = string,
  TAccountReentrancyGuard extends string | AccountMeta<string> = string,
  TAccountClient extends string | AccountMeta<string> = string,
  TAccountAgent extends string | AccountMeta<string> = string,
  TAccountClientWsolAccount extends string | AccountMeta<string> = string,
  TAccountEscrowWsolAccount extends string | AccountMeta<string> = string,
  TAccountNativeMint extends string | AccountMeta<string> =
    "So11111111111111111111111111111111111111112",
  TAccountTokenProgram extends string | AccountMeta<string> =
    "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",
  TAccountAssociatedTokenProgram extends string | AccountMeta<string> =
    "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",
  TAccountSystemProgram extends string | AccountMeta<string> =
    "11111111111111111111111111111111",
  TRemainingAccounts extends readonly AccountMeta<string>[] = [],
> = Instruction<TProgram> &
  InstructionWithData<ReadonlyUint8Array> &
  InstructionWithAccounts<
    [
      TAccountEscrow extends string
        ? WritableAccount<TAccountEscrow>
        : TAccountEscrow,
      TAccountReentrancyGuard extends string
        ? WritableAccount<TAccountReentrancyGuard>
        : TAccountReentrancyGuard,
      TAccountClient extends string
        ? WritableSignerAccount<TAccountClient> &
            AccountSignerMeta<TAccountClient>
        : TAccountClient,
      TAccountAgent extends string
        ? ReadonlyAccount<TAccountAgent>
        : TAccountAgent,
      TAccountClientWsolAccount extends string
        ? WritableAccount<TAccountClientWsolAccount>
        : TAccountClientWsolAccount,
      TAccountEscrowWsolAccount extends string
        ? WritableAccount<TAccountEscrowWsolAccount>
        : TAccountEscrowWsolAccount,
      TAccountNativeMint extends string
        ? ReadonlyAccount<TAccountNativeMint>
        : TAccountNativeMint,
      TAccountTokenProgram extends string
        ? ReadonlyAccount<TAccountTokenProgram>
        : TAccountTokenProgram,
      TAccountAssociatedTokenProgram extends string
        ? ReadonlyAccount<TAccountAssociatedTokenProgram>
        : TAccountAssociatedTokenProgram,
      TAccountSystemProgram extends string
        ? ReadonlyAccount<TAccountSystemProgram>
        : TAccountSystemProgram,
      ...TRemainingAccounts,
    ]
  >;

export type CreateEscrowWithSolInstructionData = {
  discriminator: ReadonlyUint8Array;
  taskId: string;
  amount: bigint;
  expiresAt: bigint;
  transferHook: Option<Address>;
  isConfidential: boolean;
};

export type CreateEscrowWithSolInstructionDataArgs = {
  taskId: string;
  amount: number | bigint;
  expiresAt: number | bigint;
  transferHook: OptionOrNullable<Address>;
  isConfidential: boolean;
};

export function getCreateEscrowWithSolInstructionDataEncoder(): Encoder<CreateEscrowWithSolInstructionDataArgs> {
  return transformEncoder(
    getStructEncoder([
      ["discriminator", fixEncoderSize(getBytesEncoder(), 8)],
      ["taskId", addEncoderSizePrefix(getUtf8Encoder(), getU32Encoder())],
      ["amount", getU64Encoder()],
      ["expiresAt", getI64Encoder()],
      ["transferHook", getOptionEncoder(getAddressEncoder())],
      ["isConfidential", getBooleanEncoder()],
    ]),
    (value) => ({
      ...value,
      discriminator: CREATE_ESCROW_WITH_SOL_DISCRIMINATOR,
    }),
  );
}

export function getCreateEscrowWithSolInstructionDataDecoder(): Decoder<CreateEscrowWithSolInstructionData> {
  return getStructDecoder([
    ["discriminator", fixDecoderSize(getBytesDecoder(), 8)],
    ["taskId", addDecoderSizePrefix(getUtf8Decoder(), getU32Decoder())],
    ["amount", getU64Decoder()],
    ["expiresAt", getI64Decoder()],
    ["transferHook", getOptionDecoder(getAddressDecoder())],
    ["isConfidential", getBooleanDecoder()],
  ]);
}

export function getCreateEscrowWithSolInstructionDataCodec(): Codec<
  CreateEscrowWithSolInstructionDataArgs,
  CreateEscrowWithSolInstructionData
> {
  return combineCodec(
    getCreateEscrowWithSolInstructionDataEncoder(),
    getCreateEscrowWithSolInstructionDataDecoder(),
  );
}

export type CreateEscrowWithSolAsyncInput<
  TAccountEscrow extends string = string,
  TAccountReentrancyGuard extends string = string,
  TAccountClient extends string = string,
  TAccountAgent extends string = string,
  TAccountClientWsolAccount extends string = string,
  TAccountEscrowWsolAccount extends string = string,
  TAccountNativeMint extends string = string,
  TAccountTokenProgram extends string = string,
  TAccountAssociatedTokenProgram extends string = string,
  TAccountSystemProgram extends string = string,
> = {
  escrow?: Address<TAccountEscrow>;
  reentrancyGuard?: Address<TAccountReentrancyGuard>;
  client: TransactionSigner<TAccountClient>;
  agent: Address<TAccountAgent>;
  /**
   * Client's wSOL token account - created if it doesn't exist
   * This will hold the wrapped SOL
   */
  clientWsolAccount?: Address<TAccountClientWsolAccount>;
  /** Escrow's wSOL token account - always created fresh */
  escrowWsolAccount?: Address<TAccountEscrowWsolAccount>;
  /** The native SOL mint (wSOL) - owned by original Token program */
  nativeMint?: Address<TAccountNativeMint>;
  /** Original Token program (not Token2022) - required for native SOL wrapping */
  tokenProgram?: Address<TAccountTokenProgram>;
  associatedTokenProgram?: Address<TAccountAssociatedTokenProgram>;
  systemProgram?: Address<TAccountSystemProgram>;
  taskId: CreateEscrowWithSolInstructionDataArgs["taskId"];
  amount: CreateEscrowWithSolInstructionDataArgs["amount"];
  expiresAt: CreateEscrowWithSolInstructionDataArgs["expiresAt"];
  transferHook: CreateEscrowWithSolInstructionDataArgs["transferHook"];
  isConfidential: CreateEscrowWithSolInstructionDataArgs["isConfidential"];
};

export async function getCreateEscrowWithSolInstructionAsync<
  TAccountEscrow extends string,
  TAccountReentrancyGuard extends string,
  TAccountClient extends string,
  TAccountAgent extends string,
  TAccountClientWsolAccount extends string,
  TAccountEscrowWsolAccount extends string,
  TAccountNativeMint extends string,
  TAccountTokenProgram extends string,
  TAccountAssociatedTokenProgram extends string,
  TAccountSystemProgram extends string,
  TProgramAddress extends Address =
    typeof GHOSTSPEAK_MARKETPLACE_PROGRAM_ADDRESS,
>(
  input: CreateEscrowWithSolAsyncInput<
    TAccountEscrow,
    TAccountReentrancyGuard,
    TAccountClient,
    TAccountAgent,
    TAccountClientWsolAccount,
    TAccountEscrowWsolAccount,
    TAccountNativeMint,
    TAccountTokenProgram,
    TAccountAssociatedTokenProgram,
    TAccountSystemProgram
  >,
  config?: { programAddress?: TProgramAddress },
): Promise<
  CreateEscrowWithSolInstruction<
    TProgramAddress,
    TAccountEscrow,
    TAccountReentrancyGuard,
    TAccountClient,
    TAccountAgent,
    TAccountClientWsolAccount,
    TAccountEscrowWsolAccount,
    TAccountNativeMint,
    TAccountTokenProgram,
    TAccountAssociatedTokenProgram,
    TAccountSystemProgram
  >
> {
  // Program address.
  const programAddress =
    config?.programAddress ?? GHOSTSPEAK_MARKETPLACE_PROGRAM_ADDRESS;

  // Original accounts.
  const originalAccounts = {
    escrow: { value: input.escrow ?? null, isWritable: true },
    reentrancyGuard: { value: input.reentrancyGuard ?? null, isWritable: true },
    client: { value: input.client ?? null, isWritable: true },
    agent: { value: input.agent ?? null, isWritable: false },
    clientWsolAccount: {
      value: input.clientWsolAccount ?? null,
      isWritable: true,
    },
    escrowWsolAccount: {
      value: input.escrowWsolAccount ?? null,
      isWritable: true,
    },
    nativeMint: { value: input.nativeMint ?? null, isWritable: false },
    tokenProgram: { value: input.tokenProgram ?? null, isWritable: false },
    associatedTokenProgram: {
      value: input.associatedTokenProgram ?? null,
      isWritable: false,
    },
    systemProgram: { value: input.systemProgram ?? null, isWritable: false },
  };
  const accounts = originalAccounts as Record<
    keyof typeof originalAccounts,
    ResolvedAccount
  >;

  // Original args.
  const args = { ...input };

  // Resolve default values.
  if (!accounts.escrow.value) {
    accounts.escrow.value = await getProgramDerivedAddress({
      programAddress,
      seeds: [
        getBytesEncoder().encode(new Uint8Array([101, 115, 99, 114, 111, 119])),
        getUtf8Encoder().encode(expectSome(args.taskId)),
      ],
    });
  }
  if (!accounts.reentrancyGuard.value) {
    accounts.reentrancyGuard.value = await getProgramDerivedAddress({
      programAddress,
      seeds: [
        getBytesEncoder().encode(
          new Uint8Array([
            114, 101, 101, 110, 116, 114, 97, 110, 99, 121, 95, 103, 117, 97,
            114, 100,
          ]),
        ),
      ],
    });
  }
  if (!accounts.nativeMint.value) {
    accounts.nativeMint.value =
      "So11111111111111111111111111111111111111112" as Address<"So11111111111111111111111111111111111111112">;
  }
  if (!accounts.clientWsolAccount.value) {
    accounts.clientWsolAccount.value = await getProgramDerivedAddress({
      programAddress:
        "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">,
      seeds: [
        getAddressEncoder().encode(expectAddress(accounts.client.value)),
        getBytesEncoder().encode(
          new Uint8Array([
            6, 221, 246, 225, 215, 101, 161, 147, 217, 203, 225, 70, 206, 235,
            121, 172, 28, 180, 133, 237, 95, 91, 55, 145, 58, 140, 245, 133,
            126, 255, 0, 169,
          ]),
        ),
        getAddressEncoder().encode(expectAddress(accounts.nativeMint.value)),
      ],
    });
  }
  if (!accounts.escrowWsolAccount.value) {
    accounts.escrowWsolAccount.value = await getProgramDerivedAddress({
      programAddress:
        "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">,
      seeds: [
        getAddressEncoder().encode(expectAddress(accounts.escrow.value)),
        getBytesEncoder().encode(
          new Uint8Array([
            6, 221, 246, 225, 215, 101, 161, 147, 217, 203, 225, 70, 206, 235,
            121, 172, 28, 180, 133, 237, 95, 91, 55, 145, 58, 140, 245, 133,
            126, 255, 0, 169,
          ]),
        ),
        getAddressEncoder().encode(expectAddress(accounts.nativeMint.value)),
      ],
    });
  }
  if (!accounts.tokenProgram.value) {
    accounts.tokenProgram.value =
      "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" as Address<"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA">;
  }
  if (!accounts.associatedTokenProgram.value) {
    accounts.associatedTokenProgram.value =
      "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">;
  }
  if (!accounts.systemProgram.value) {
    accounts.systemProgram.value =
      "11111111111111111111111111111111" as Address<"11111111111111111111111111111111">;
  }

  const getAccountMeta = getAccountMetaFactory(programAddress, "programId");
  return Object.freeze({
    accounts: [
      getAccountMeta(accounts.escrow),
      getAccountMeta(accounts.reentrancyGuard),
      getAccountMeta(accounts.client),
      getAccountMeta(accounts.agent),
      getAccountMeta(accounts.clientWsolAccount),
      getAccountMeta(accounts.escrowWsolAccount),
      getAccountMeta(accounts.nativeMint),
      getAccountMeta(accounts.tokenProgram),
      getAccountMeta(accounts.associatedTokenProgram),
      getAccountMeta(accounts.systemProgram),
    ],
    data: getCreateEscrowWithSolInstructionDataEncoder().encode(
      args as CreateEscrowWithSolInstructionDataArgs,
    ),
    programAddress,
  } as CreateEscrowWithSolInstruction<
    TProgramAddress,
    TAccountEscrow,
    TAccountReentrancyGuard,
    TAccountClient,
    TAccountAgent,
    TAccountClientWsolAccount,
    TAccountEscrowWsolAccount,
    TAccountNativeMint,
    TAccountTokenProgram,
    TAccountAssociatedTokenProgram,
    TAccountSystemProgram
  >);
}

export type CreateEscrowWithSolInput<
  TAccountEscrow extends string = string,
  TAccountReentrancyGuard extends string = string,
  TAccountClient extends string = string,
  TAccountAgent extends string = string,
  TAccountClientWsolAccount extends string = string,
  TAccountEscrowWsolAccount extends string = string,
  TAccountNativeMint extends string = string,
  TAccountTokenProgram extends string = string,
  TAccountAssociatedTokenProgram extends string = string,
  TAccountSystemProgram extends string = string,
> = {
  escrow: Address<TAccountEscrow>;
  reentrancyGuard: Address<TAccountReentrancyGuard>;
  client: TransactionSigner<TAccountClient>;
  agent: Address<TAccountAgent>;
  /**
   * Client's wSOL token account - created if it doesn't exist
   * This will hold the wrapped SOL
   */
  clientWsolAccount: Address<TAccountClientWsolAccount>;
  /** Escrow's wSOL token account - always created fresh */
  escrowWsolAccount: Address<TAccountEscrowWsolAccount>;
  /** The native SOL mint (wSOL) - owned by original Token program */
  nativeMint?: Address<TAccountNativeMint>;
  /** Original Token program (not Token2022) - required for native SOL wrapping */
  tokenProgram?: Address<TAccountTokenProgram>;
  associatedTokenProgram?: Address<TAccountAssociatedTokenProgram>;
  systemProgram?: Address<TAccountSystemProgram>;
  taskId: CreateEscrowWithSolInstructionDataArgs["taskId"];
  amount: CreateEscrowWithSolInstructionDataArgs["amount"];
  expiresAt: CreateEscrowWithSolInstructionDataArgs["expiresAt"];
  transferHook: CreateEscrowWithSolInstructionDataArgs["transferHook"];
  isConfidential: CreateEscrowWithSolInstructionDataArgs["isConfidential"];
};

export function getCreateEscrowWithSolInstruction<
  TAccountEscrow extends string,
  TAccountReentrancyGuard extends string,
  TAccountClient extends string,
  TAccountAgent extends string,
  TAccountClientWsolAccount extends string,
  TAccountEscrowWsolAccount extends string,
  TAccountNativeMint extends string,
  TAccountTokenProgram extends string,
  TAccountAssociatedTokenProgram extends string,
  TAccountSystemProgram extends string,
  TProgramAddress extends Address =
    typeof GHOSTSPEAK_MARKETPLACE_PROGRAM_ADDRESS,
>(
  input: CreateEscrowWithSolInput<
    TAccountEscrow,
    TAccountReentrancyGuard,
    TAccountClient,
    TAccountAgent,
    TAccountClientWsolAccount,
    TAccountEscrowWsolAccount,
    TAccountNativeMint,
    TAccountTokenProgram,
    TAccountAssociatedTokenProgram,
    TAccountSystemProgram
  >,
  config?: { programAddress?: TProgramAddress },
): CreateEscrowWithSolInstruction<
  TProgramAddress,
  TAccountEscrow,
  TAccountReentrancyGuard,
  TAccountClient,
  TAccountAgent,
  TAccountClientWsolAccount,
  TAccountEscrowWsolAccount,
  TAccountNativeMint,
  TAccountTokenProgram,
  TAccountAssociatedTokenProgram,
  TAccountSystemProgram
> {
  // Program address.
  const programAddress =
    config?.programAddress ?? GHOSTSPEAK_MARKETPLACE_PROGRAM_ADDRESS;

  // Original accounts.
  const originalAccounts = {
    escrow: { value: input.escrow ?? null, isWritable: true },
    reentrancyGuard: { value: input.reentrancyGuard ?? null, isWritable: true },
    client: { value: input.client ?? null, isWritable: true },
    agent: { value: input.agent ?? null, isWritable: false },
    clientWsolAccount: {
      value: input.clientWsolAccount ?? null,
      isWritable: true,
    },
    escrowWsolAccount: {
      value: input.escrowWsolAccount ?? null,
      isWritable: true,
    },
    nativeMint: { value: input.nativeMint ?? null, isWritable: false },
    tokenProgram: { value: input.tokenProgram ?? null, isWritable: false },
    associatedTokenProgram: {
      value: input.associatedTokenProgram ?? null,
      isWritable: false,
    },
    systemProgram: { value: input.systemProgram ?? null, isWritable: false },
  };
  const accounts = originalAccounts as Record<
    keyof typeof originalAccounts,
    ResolvedAccount
  >;

  // Original args.
  const args = { ...input };

  // Resolve default values.
  if (!accounts.nativeMint.value) {
    accounts.nativeMint.value =
      "So11111111111111111111111111111111111111112" as Address<"So11111111111111111111111111111111111111112">;
  }
  if (!accounts.tokenProgram.value) {
    accounts.tokenProgram.value =
      "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" as Address<"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA">;
  }
  if (!accounts.associatedTokenProgram.value) {
    accounts.associatedTokenProgram.value =
      "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">;
  }
  if (!accounts.systemProgram.value) {
    accounts.systemProgram.value =
      "11111111111111111111111111111111" as Address<"11111111111111111111111111111111">;
  }

  const getAccountMeta = getAccountMetaFactory(programAddress, "programId");
  return Object.freeze({
    accounts: [
      getAccountMeta(accounts.escrow),
      getAccountMeta(accounts.reentrancyGuard),
      getAccountMeta(accounts.client),
      getAccountMeta(accounts.agent),
      getAccountMeta(accounts.clientWsolAccount),
      getAccountMeta(accounts.escrowWsolAccount),
      getAccountMeta(accounts.nativeMint),
      getAccountMeta(accounts.tokenProgram),
      getAccountMeta(accounts.associatedTokenProgram),
      getAccountMeta(accounts.systemProgram),
    ],
    data: getCreateEscrowWithSolInstructionDataEncoder().encode(
      args as CreateEscrowWithSolInstructionDataArgs,
    ),
    programAddress,
  } as CreateEscrowWithSolInstruction<
    TProgramAddress,
    TAccountEscrow,
    TAccountReentrancyGuard,
    TAccountClient,
    TAccountAgent,
    TAccountClientWsolAccount,
    TAccountEscrowWsolAccount,
    TAccountNativeMint,
    TAccountTokenProgram,
    TAccountAssociatedTokenProgram,
    TAccountSystemProgram
  >);
}

export type ParsedCreateEscrowWithSolInstruction<
  TProgram extends string = typeof GHOSTSPEAK_MARKETPLACE_PROGRAM_ADDRESS,
  TAccountMetas extends readonly AccountMeta[] = readonly AccountMeta[],
> = {
  programAddress: Address<TProgram>;
  accounts: {
    escrow: TAccountMetas[0];
    reentrancyGuard: TAccountMetas[1];
    client: TAccountMetas[2];
    agent: TAccountMetas[3];
    /**
     * Client's wSOL token account - created if it doesn't exist
     * This will hold the wrapped SOL
     */
    clientWsolAccount: TAccountMetas[4];
    /** Escrow's wSOL token account - always created fresh */
    escrowWsolAccount: TAccountMetas[5];
    /** The native SOL mint (wSOL) - owned by original Token program */
    nativeMint: TAccountMetas[6];
    /** Original Token program (not Token2022) - required for native SOL wrapping */
    tokenProgram: TAccountMetas[7];
    associatedTokenProgram: TAccountMetas[8];
    systemProgram: TAccountMetas[9];
  };
  data: CreateEscrowWithSolInstructionData;
};

export function parseCreateEscrowWithSolInstruction<
  TProgram extends string,
  TAccountMetas extends readonly AccountMeta[],
>(
  instruction: Instruction<TProgram> &
    InstructionWithAccounts<TAccountMetas> &
    InstructionWithData<ReadonlyUint8Array>,
): ParsedCreateEscrowWithSolInstruction<TProgram, TAccountMetas> {
  if (instruction.accounts.length < 10) {
    // TODO: Coded error.
    throw new Error("Not enough accounts");
  }
  let accountIndex = 0;
  const getNextAccount = () => {
    const accountMeta = (instruction.accounts as TAccountMetas)[accountIndex]!;
    accountIndex += 1;
    return accountMeta;
  };
  return {
    programAddress: instruction.programAddress,
    accounts: {
      escrow: getNextAccount(),
      reentrancyGuard: getNextAccount(),
      client: getNextAccount(),
      agent: getNextAccount(),
      clientWsolAccount: getNextAccount(),
      escrowWsolAccount: getNextAccount(),
      nativeMint: getNextAccount(),
      tokenProgram: getNextAccount(),
      associatedTokenProgram: getNextAccount(),
      systemProgram: getNextAccount(),
    },
    data: getCreateEscrowWithSolInstructionDataDecoder().decode(
      instruction.data,
    ),
  };
}
