
> @ghostspeak/sdk@2.0.1 test
> vitest run --reporter=verbose tests/unit/crypto/wasm-crypto-bridge.test.ts

 DEPRECATED  "cache.dir" is deprecated, use Vite's "cacheDir" instead if you want to change the cache director. Note caches will be written to "cacheDir/vitest"

 RUN  v3.2.4 /Users/home/projects/GhostSpeak/packages/sdk-typescript

stdout | tests/unit/crypto/wasm-crypto-bridge.test.ts
ğŸš€ Initializing WebAssembly crypto module...

stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts
WASM module not found, disabling WASM features

stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should return cached initialization promise
âŒ Failed to initialize WebAssembly crypto module: TypeError: Cannot read properties of undefined (reading 'simd_enabled')
    at WasmElGamalEngineWrapper.get_performance_info [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:241:39[90m)[39m
    at [90m/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:320:35

 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should initialize WASM module successfully 2ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should handle WASM initialization failure gracefully 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should detect missing WebAssembly support 0ms
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should return cached initialization promise 6ms
   â†’ expected false to be true // Object.is equality
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > WASM Engine Access > should throw error when accessing engine before initialization 2ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > WASM Engine Access > should return engine after successful initialization 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Keypair Generation > should generate keypair using WASM when available 1ms
stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Keypair Generation > should handle WASM keypair generation failure
âŒ Failed to initialize WebAssembly crypto module: Error: WASM error
    at t.<anonymous> [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39mtests/unit/crypto/wasm-crypto-bridge.test.ts:178:15[90m)[39m
    at new mockCall (file:///Users/home/projects/GhostSpeak/node_modules/[4m.bun[24m/@vitest+spy@3.2.4/node_modules/[4m@vitest/spy[24m/dist/index.js:96:15)
    at new spy (file:///Users/home/projects/GhostSpeak/node_modules/[4m.bun[24m/tinyspy@4.0.4/node_modules/[4mtinyspy[24m/dist/index.js:47:34)
    at new WasmElGamalEngineWrapper [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:185:27[90m)[39m
    at [90m/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:314:20

stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should fallback to JavaScript on WASM encryption failure
âŒ Failed to initialize WebAssembly crypto module: TypeError: this.engine.get_performance_info is not a function
    at WasmElGamalEngineWrapper.get_performance_info [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:238:42[90m)[39m
    at [90m/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:320:35

 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Keypair Generation > should fallback to JavaScript implementation when WASM unavailable 109ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Keypair Generation > should handle WASM keypair generation failure 2ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should encrypt amount using WASM 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should handle large amounts by capping at MAX_SAFE_INTEGER 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should measure encryption performance 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should fallback to JavaScript on WASM encryption failure 3ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should batch encrypt using WASM for multiple amounts 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should use sequential encryption for single amount 0ms
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should pack amounts correctly for WASM 1ms
   â†’ expected "spy" to be called at least once
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should handle batch encryption failure gracefully 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Range Proof Generation > should generate range proof using WASM 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Range Proof Generation > should log warning for slow range proof generation 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Range Proof Generation > should handle range proof generation failure 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Range Proof Generation > should batch generate range proofs using WASM 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Range Proof Generation > should pack proof data correctly for WASM 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Range Proof Generation > should calculate average time per proof 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should return performance info when WASM is available 1ms
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should return null performance info when WASM unavailable 1ms
   â†’ expected true to be false // Object.is equality
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should run scalar multiplication benchmarks 1ms
   â†’ expected "spy" to be called with arguments: [ 100 ][90m

Number of calls: [1m0[22m
[39m
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should run full crypto benchmarks 24ms
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should calculate speedup factors correctly 20ms
   â†’ expected +0 to be 4 // Object.is equality
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should handle benchmark when WASM is unavailable 20ms
   â†’ expected 510 to be +0 // Object.is equality
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Auto-initialization > should auto-initialize on module import 1ms
   â†’ expected [Function] to not throw an error but 'Error: Cannot find module \'../../../â€¦' was thrown

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 7 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should return cached initialization promise
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:120:23
    118|       // All should resolve to the same value
    119|       const [result1, result2, result3] = await Promise.all([promise1,â€¦
    120|       expect(result1).toBe(true)
       |                       ^
    121|       expect(result2).toBe(true)
    122|       expect(result3).toBe(true)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/7]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should pack amounts correctly for WASM
AssertionError: expected "spy" to be called at least once
 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:290:31
    288|       await batchEncryptAmounts(testAmounts, testPublicKey)
    289|       
    290|       expect(batchEncryptSpy).toHaveBeenCalled()
       |                               ^
    291|       const packedAmounts = batchEncryptSpy.mock.calls[0][0]
    292|       expect(packedAmounts).toBeInstanceOf(Uint8Array)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/7]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should return null performance info when WASM unavailable
AssertionError: expected true to be false // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:458:36
    456|       const perfInfo = await getCryptoPerformanceInfo()
    457|       
    458|       expect(perfInfo.isAvailable).toBe(false)
       |                                    ^
    459|       expect(perfInfo.wasm).toBeNull()
    460|       expect(perfInfo.version).toBeNull()

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/7]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should run scalar multiplication benchmarks
AssertionError: expected "spy" to be called with arguments: [ 100 ][90m

Number of calls: [1m0[22m
[39m
 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:484:28
    482|       const perfInfo = await getCryptoPerformanceInfo()
    483|       
    484|       expect(benchmarkSpy).toHaveBeenCalledWith(100)
       |                            ^
    485|       expect(benchmarkSpy).toHaveBeenCalledWith(1000)
    486|       expect(perfInfo.benchmarkResults?.scalar_mult_100).toBe(5)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/7]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should calculate speedup factors correctly
AssertionError: expected +0 to be 4 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 4[39m
[31m+ 0[39m

 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:540:45
    538|       
    539|       // WASM should show speedup
    540|       expect(benchmarks.encryption.speedup).toBe(4) // 400/100 = 4x
       |                                             ^
    541|       expect(benchmarks.rangeProof.speedup).toBe(4) // 200/50 = 4x
    542|       expect(benchmarks.batchEncryption.speedup).toBe(4) // 200/50 = 4x

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/7]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should handle benchmark when WASM is unavailable
AssertionError: expected 510 to be +0 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 0[39m
[31m+ 510[39m

 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:549:42
    547|       
    548|       // Should still run JS benchmarks
    549|       expect(benchmarks.encryption.wasm).toBe(0)
       |                                          ^
    550|       expect(benchmarks.encryption.js).toBeGreaterThan(0)
    551|       expect(benchmarks.encryption.speedup).toBe(0)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/7]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Auto-initialization > should auto-initialize on module import
AssertionError: expected [Function] to not throw an error but 'Error: Cannot find module \'../../../â€¦' was thrown

[32m- Expected:[39m 
undefined

[31m+ Received:[39m 
"Error: Cannot find module '../../../src/utils/wasm-crypto-bridge'
Require stack:
- /Users/home/projects/GhostSpeak/packages/sdk-typescript/tests/unit/crypto/wasm-crypto-bridge.test.ts"

 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:560:74
    558|       // We can't easily test this without resetting the entire moduleâ€¦
    559|       // But we can verify it doesn't throw
    560|       expect(() => require('../../../src/utils/wasm-crypto-bridge')).nâ€¦
       |                                                                          ^
    561|     })
    562|   })

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/7]â¯


 Test Files  1 failed (1)
      Tests  7 failed | 23 passed (30)
   Start at  16:45:36
   Duration  376ms (transform 73ms, setup 17ms, collect 50ms, tests 202ms, environment 0ms, prepare 35ms)

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/home/projects/GhostSpeak/packages/sdk-typescript
npm error workspace @ghostspeak/sdk@2.0.1
npm error location /Users/home/projects/GhostSpeak/packages/sdk-typescript
npm error command failed
npm error command sh -c vitest run --reporter=verbose tests/unit/crypto/wasm-crypto-bridge.test.ts
