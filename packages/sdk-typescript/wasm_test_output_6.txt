
> @ghostspeak/sdk@2.0.1 test
> vitest run --reporter=verbose tests/unit/crypto/wasm-crypto-bridge.test.ts

 DEPRECATED  "cache.dir" is deprecated, use Vite's "cacheDir" instead if you want to change the cache director. Note caches will be written to "cacheDir/vitest"

 RUN  v3.2.4 /Users/home/projects/GhostSpeak/packages/sdk-typescript

stdout | tests/unit/crypto/wasm-crypto-bridge.test.ts
ğŸš€ Initializing WebAssembly crypto module...

stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts
WASM module not found, disabling WASM features

stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should return cached initialization promise
âŒ Failed to initialize WebAssembly crypto module: TypeError: Cannot read properties of undefined (reading 'simd_enabled')
    at WasmElGamalEngineWrapper.get_performance_info [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:241:39[90m)[39m
    at [90m/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:320:35

stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Keypair Generation > should handle WASM keypair generation failure
âŒ Failed to initialize WebAssembly crypto module: Error: WASM error
    at t.<anonymous> [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39mtests/unit/crypto/wasm-crypto-bridge.test.ts:193:15[90m)[39m
    at new mockCall (file:///Users/home/projects/GhostSpeak/node_modules/[4m.bun[24m/@vitest+spy@3.2.4/node_modules/[4m@vitest/spy[24m/dist/index.js:96:15)
    at new spy (file:///Users/home/projects/GhostSpeak/node_modules/[4m.bun[24m/tinyspy@4.0.4/node_modules/[4mtinyspy[24m/dist/index.js:47:34)
    at new WasmElGamalEngineWrapper [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:185:27[90m)[39m
    at [90m/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:314:20

stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should fallback to JavaScript on WASM encryption failure
âŒ Failed to initialize WebAssembly crypto module: TypeError: this.engine.get_performance_info is not a function
    at WasmElGamalEngineWrapper.get_performance_info [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:238:42[90m)[39m
    at [90m/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:320:35

 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should initialize WASM module successfully 2ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should handle WASM initialization failure gracefully 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should detect missing WebAssembly support 0ms
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should return cached initialization promise 4ms
   â†’ expected Promise{â€¦} to be Promise{â€¦} // Object.is equality

If it should pass with deep equality, replace "toBe" with "toStrictEqual"

Expected: Promise{â€¦}
Received: serializes to the same string

 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > WASM Engine Access > should throw error when accessing engine before initialization 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > WASM Engine Access > should return engine after successful initialization 0ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Keypair Generation > should generate keypair using WASM when available 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Keypair Generation > should fallback to JavaScript implementation when WASM unavailable 85ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Keypair Generation > should handle WASM keypair generation failure 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should encrypt amount using WASM 0ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should handle large amounts by capping at MAX_SAFE_INTEGER 0ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should measure encryption performance 0ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Encryption Operations > should fallback to JavaScript on WASM encryption failure 3ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should batch encrypt using WASM for multiple amounts 1ms
stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should pack amounts correctly for WASM
âŒ Failed to initialize WebAssembly crypto module: TypeError: Cannot read properties of undefined (reading 'simd_enabled')
    at WasmElGamalEngineWrapper.get_performance_info [90m(/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:241:39[90m)[39m
    at [90m/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:320:35

stderr | tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should return null performance info when WASM unavailable
âŒ Failed to initialize WebAssembly crypto module: Error: WASM module initialization failed
    at [90m/Users/home/projects/GhostSpeak/packages/sdk-typescript/[39msrc/utils/wasm-crypto-bridge.ts:173:15

 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should use sequential encryption for single amount 1ms
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should pack amounts correctly for WASM 10ms
   â†’ expected "spy" to be called at least once
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should handle batch encryption failure gracefully 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Range Proof Generation > should generate range proof using WASM 1ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Range Proof Generation > should log warning for slow range proof generation 3ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Range Proof Generation > should handle range proof generation failure 2ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Range Proof Generation > should batch generate range proofs using WASM 4ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Range Proof Generation > should pack proof data correctly for WASM 3ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Range Proof Generation > should calculate average time per proof 3ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should return performance info when WASM is available 2ms
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should return null performance info when WASM unavailable 1ms
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should run scalar multiplication benchmarks 1ms
   â†’ expected "spy" to be called with arguments: [ 100 ][90m

Number of calls: [1m0[22m
[39m
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should run full crypto benchmarks 37ms
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should calculate speedup factors correctly 21ms
   â†’ expected +0 to be 4 // Object.is equality
 Ã— tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should handle benchmark when WASM is unavailable 20ms
   â†’ expected 510 to be +0 // Object.is equality
 âœ“ tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Auto-initialization > should auto-initialize on module import 1ms

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 5 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Module Initialization > should return cached initialization promise
AssertionError: expected Promise{â€¦} to be Promise{â€¦} // Object.is equality

If it should pass with deep equality, replace "toBe" with "toStrictEqual"

Expected: Promise{â€¦}
Received: serializes to the same string


[2mCompared values have no visual difference.[22m

 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:121:24
    119|       const promise3 = initializeWasmCrypto()
    120|       
    121|       expect(promise1).toBe(promise2)
       |                        ^
    122|       expect(promise2).toBe(promise3)
    123|       

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/5]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Batch Encryption > should pack amounts correctly for WASM
AssertionError: expected "spy" to be called at least once
 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:311:31
    309|       await batchEncryptAmounts(testAmounts, testPublicKey)
    310|       
    311|       expect(batchEncryptSpy).toHaveBeenCalled()
       |                               ^
    312|       const packedAmounts = batchEncryptSpy.mock.calls[0][0]
    313|       expect(packedAmounts).toBeInstanceOf(Uint8Array)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/5]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Performance Information > should run scalar multiplication benchmarks
AssertionError: expected "spy" to be called with arguments: [ 100 ][90m

Number of calls: [1m0[22m
[39m
 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:509:28
    507|       const perfInfo = await getCryptoPerformanceInfo()
    508|       
    509|       expect(benchmarkSpy).toHaveBeenCalledWith(100)
       |                            ^
    510|       expect(benchmarkSpy).toHaveBeenCalledWith(1000)
    511|       expect(perfInfo.benchmarkResults?.scalar_mult_100).toBe(5)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/5]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should calculate speedup factors correctly
AssertionError: expected +0 to be 4 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 4[39m
[31m+ 0[39m

 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:565:45
    563|       
    564|       // WASM should show speedup
    565|       expect(benchmarks.encryption.speedup).toBe(4) // 400/100 = 4x
       |                                             ^
    566|       expect(benchmarks.rangeProof.speedup).toBe(4) // 200/50 = 4x
    567|       expect(benchmarks.batchEncryption.speedup).toBe(4) // 200/50 = 4x

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/5]â¯

 FAIL  tests/unit/crypto/wasm-crypto-bridge.test.ts > WASM Crypto Bridge > Comprehensive Benchmarks > should handle benchmark when WASM is unavailable
AssertionError: expected 510 to be +0 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 0[39m
[31m+ 510[39m

 â¯ tests/unit/crypto/wasm-crypto-bridge.test.ts:574:42
    572|       
    573|       // Should still run JS benchmarks
    574|       expect(benchmarks.encryption.wasm).toBe(0)
       |                                          ^
    575|       expect(benchmarks.encryption.js).toBeGreaterThan(0)
    576|       expect(benchmarks.encryption.speedup).toBe(0)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/5]â¯


 Test Files  1 failed (1)
      Tests  5 failed | 25 passed (30)
   Start at  16:53:11
   Duration  353ms (transform 56ms, setup 16ms, collect 35ms, tests 212ms, environment 0ms, prepare 27ms)

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/home/projects/GhostSpeak/packages/sdk-typescript
npm error workspace @ghostspeak/sdk@2.0.1
npm error location /Users/home/projects/GhostSpeak/packages/sdk-typescript
npm error command failed
npm error command sh -c vitest run --reporter=verbose tests/unit/crypto/wasm-crypto-bridge.test.ts
